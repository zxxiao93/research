webpackJsonp([3],{147:function(t,e,i){i(604);var a=i(28)(i(330),i(625),"data-v-47e0ac16",null);t.exports=a.exports},170:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var a=function(t){t="number"==typeof t?t:Number(t);var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}},217:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["questionList","isPreview"],methods:{delQuestion:function(t){console.log(t),this.$store.dispatch("delQuestion",t)},delOption:function(t,e){console.log(t,e),this.$store.dispatch("delOption",{index:t,opIndex:e})}},created:function(){console.log("imported successfully",this.questionList,this.isPreview)}}},218:function(t,e,i){e=t.exports=i(133)(!1),e.push([t.i,".question-list[data-v-200a39eb]{padding:30px 0;overflow:visible}.checkbox-list label[data-v-200a39eb]{display:block}.question-options[data-v-200a39eb]{padding:5px 0}.option-item[data-v-200a39eb]{margin:5px 0}.question-desc[data-v-200a39eb]{padding:5px 0}.question-action[data-v-200a39eb]{display:none;color:#a9afb2}.question-item[data-v-200a39eb]{padding:20px 0;min-width:300px}.question-item[data-v-200a39eb]:hover{background:hsla(0,0%,93%,.47)}.question-item:hover .question-action[data-v-200a39eb]{display:block;margin-top:8px}.question-action[data-v-200a39eb]:hover{color:#018fe5;cursor:pointer}.question-btns[data-v-200a39eb]{margin-top:20px}.option-action[data-v-200a39eb]{display:none;margin-left:100px;padding:0 10px;text-align:right;color:#a9afb2}.option-action[data-v-200a39eb]:hover{color:#018fe5}.option-item:hover .option-action[data-v-200a39eb]{display:inline-block;cursor:pointer}",""])},236:function(t,e,i){var a=i(218);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(134)("5583ec03",a,!0)},237:function(t,e,i){i(236);var a=i(28)(i(217),i(238),"data-v-200a39eb",null);t.exports=a.exports},238:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Row",{staticClass:"question-wrapper"},[i("Col",{staticClass:"question-list",attrs:{span:"24"}},[0==t.questionList.length?i("p",{staticStyle:{margin:"10px 0"}},[t._v("一点东西都没有，赶快点击上方按钮添加题目吧！")]):t._e(),t._v(" "),t._l(t.questionList,function(e,a){return i("Row",{key:e.q_id,staticClass:"question-item",attrs:{type:"flex",justify:"start",align:"top"}},[i("Col",{staticStyle:{width:"60px","text-align":"center"},attrs:{span:"6"}},[i("h2",[t._v("Q"+t._s(a+1)+":")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isPreview,expression:"isPreview"}],staticClass:"question-action",on:{click:function(e){t.delQuestion(a)}}},[i("Icon",{attrs:{type:"trash-a",size:"18"}})],1)]),t._v(" "),i("Col",{attrs:{span:"18"}},[i("h3",[t._v("["+t._s(e.type)+"] "+t._s(e.question)+t._s(e.isRequired?"（必填）":"（选填）")+" "),e.isRequired?i("span",{staticStyle:{color:"#f00"}},[t._v("*")]):t._e()]),t._v(" "),""!==e.description?i("p",{staticClass:"question-desc"},[t._v("说明："+t._s(e.description))]):t._e(),t._v(" "),i("div",{staticClass:"question-options"},["单选"===e.type?i("div",[i("Radio-group",{staticStyle:{width:"100%"},attrs:{vertical:""},model:{value:e.selectContent,callback:function(t){e.selectContent=t},expression:"topic.selectContent"}},t._l(e.options,function(n,s){return i("Radio",{key:n.o_id,staticClass:"option-item",attrs:{label:n.o_id,disabled:t.isPreview}},[i("span",[t._v(t._s(n.content))]),t._v(" "),n.isAddition?i("Input",{directives:[{name:"show",rawName:"v-show",value:n.isAddition&&e.selectContent===n.o_id,expression:"option.isAddition && topic.selectContent === option.o_id "}],staticStyle:{width:"300px"},attrs:{placeholder:"请输入理由"},model:{value:e.additional,callback:function(t){e.additional=t},expression:"topic.additional"}}):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isPreview,expression:"isPreview"}],staticClass:"option-action",on:{click:function(e){t.delOption(a,s)}}},[i("Icon",{attrs:{type:"close",size:"16"}})],1)],1)}))],1):t._e(),t._v(" "),"多选"===e.type?i("div",[i("Checkbox-group",{staticClass:"checkbox-list",model:{value:e.selectMultipleContent,callback:function(t){e.selectMultipleContent=t},expression:"topic.selectMultipleContent"}},t._l(e.options,function(e,n){return i("Checkbox",{key:e.o_id,staticClass:"option-item",attrs:{label:e.o_id,disabled:t.isPreview}},[i("span",[t._v(t._s(e.content))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isPreview,expression:"isPreview"}],staticClass:"option-action",on:{click:function(e){t.delOption(a,n)}}},[i("Icon",{attrs:{type:"close",size:"16"}})],1)])}))],1):t._e(),t._v(" "),"文本"===e.type?i("div",{staticClass:"option-item"},[i("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请输入...",disabled:t.isPreview},model:{value:e.selectContent,callback:function(t){e.selectContent=t},expression:"topic.selectContent"}})],1):t._e()])])],1)}),t._v(" "),i("div",{staticClass:"question-btns"},[t._t("default")],2)],2)],1)},staticRenderFns:[]}},330:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(237),n=i.n(a),s=i(170);e.default={data:function(){return{naire:{topic:[]},finished:!1,spinShow:!0,isLogin:!1,userId:0,userInfo:{name:"",identity:""},userInfoRule:{name:[{required:!0,message:"请填写用户名",trigger:"blur"}],identity:[{required:!0,message:"请填写身份证",trigger:"blur"},{type:"string",max:18,min:18,message:"身份证长度不正确",trigger:"blur"}]}}},filters:{timeFormat:function(t){return i.i(s.a)(t)}},watch:{$route:"fetchData"},methods:{handleSubmit:function(t){var e=this;this.$refs[t].validate(function(t){t?e.$http.post("/api/user/getId",{n_id:e.naire.n_id,name:e.userInfo.name,identity:e.userInfo.identity.toUpperCase()}).then(function(t){console.log(t.data.data),0!==t.data.err||t.data.data.isFinished?t.data.data.isFinished?(e.$Notice.warning({title:"已完成问卷",desc:"您已完成该问卷，请勿重复提交！",duration:5}),e.$router.push("/complete")):e.$Notice.warning({title:"用户不存在",desc:"请确认姓名和身份证号后重试！",duration:5}):(e.isLogin=!0,console.log(t.data.data.u_id),e.userId=t.data.data.u_id,e.$Notice.open({title:"欢迎您 "+t.data.data.name,desc:"请继续完成问卷内容吧！",duration:5}))}).catch(function(t){console.log(t),e.$Message.error("用户登录失败，请重试")}):e.$Message.error("请先填写用户信息!")})},error:function(t,e,i){this.$Notice.error({title:e,desc:t?"":i})},fetchData:function(){var t=this;console.log(this.$route.params.id),this.$store.dispatch("getNaire",{n_id:this.$route.params.id}).then(function(e){0===e.data.err?(t.$store.commit("REQUEST_QUESTION_LIST",{naire:e.data.data}),t.naire=e.data.data,t.spinShow=!1):(t.$Message.error(e.data.data),t.$router.push("/404"))}).catch(function(e){console.log(e),t.$Message.error("获取问卷，请重试")})},goBack:function(){this.$router.push("/platform")},validateNaire:function(){var t=!0,e=!1,i=!0;return this.naire.topic.forEach(function(i,a){if(i.isRequired){if("文本"===i.type&&!i.selectContent.trim().length>0&&(t=!1),"单选"===i.type){i.options.some(function(t,e){return t.isAddition&&t.o_id===i.selectContent})&&!i.additional.trim().length>0&&(e=!0),!i.selectContent.trim().length>0&&(t=!1)}"多选"===i.type&&!i.selectMultipleContent.length>0&&(t=!1)}}),t||(this.error(!0,"您还有必填项未填，请检查后提交！",""),i=!1),e&&(this.error(!0,"请填写附加理由",""),i=!1),this.isLogin||(this.error(!0,"请先填写用户信息",""),i=!1),i},submitNaire:function(){var t=this;if(this.validateNaire()){var e=this.naire.n_id,i=[];this.naire.topic.forEach(function(a,n){if("单选"===a.type){var s={n_id:e,u_id:t.userId,q_id:a.q_id,o_id:a.selectContent,o_addition:a.additional.trim()};i.push(s)}else if("多选"===a.type){var o={n_id:e,u_id:t.userId,q_id:a.q_id,o_id:a.selectMultipleContent,o_addition:a.additional.trim()};i.push(o)}else{var r={n_id:e,u_id:t.userId,q_id:a.q_id,o_id:"",o_addition:a.selectContent.trim()};i.push(r)}}),console.log(i),this.finished=!0,this.$http.post("/api/naire/submit",{result:i}).then(function(e){console.log(e.data),0===e.data.err?(t.$Message.success(e.data.data),t.$router.push("/complete")):(t.$Message.error(e.data.data),t.finished=!1)}).catch(function(e){console.log(e),t.$Message.error("提交失败，请重试"),t.finished=!1})}}},computed:{isAdmin:function(){return this.$store.getters.isAdmin},isExpired:function(){return Number(this.naire.deadline)<(new Date).getTime()},isNotPublish:function(){return"0"===this.naire.status}},created:function(){this.fetchData()},components:{questionList:n.a}}},337:function(t,e,i){e=t.exports=i(133)(!1),e.push([t.i,".view-layout[data-v-47e0ac16]{background-color:#edf0f8;min-height:100%;max-height:100%;height:100%;width:100%;padding:20px 10px;overflow-y:scroll}.view-layout .main[data-v-47e0ac16]{max-width:800px;width:100%;height:auto;margin:0 auto;padding-bottom:30px;background-color:#fff;box-shadow:0 2px 5px 1px hsla(0,0%,49%,.2)}.view-layout .header[data-v-47e0ac16]{padding:30px 20px;height:auto;min-height:33px;border-bottom:2px dotted #eee}.view-layout .header h1[data-v-47e0ac16]{width:100%;margin:0 auto;text-align:center}.view-layout .content[data-v-47e0ac16]{padding:20px}.view-layout .intro[data-v-47e0ac16]{font-size:14px;text-indent:2em}.view-layout .footer[data-v-47e0ac16]{margin-top:10px;padding-top:10px;text-align:center;border-top:1px dotted #eee}.code-row-bg button[data-v-47e0ac16]{margin:0 10px}.user-info[data-v-47e0ac16]{width:100%;padding:30px 30px 0}",""])},604:function(t,e,i){var a=i(337);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(134)("0e8b0a84",a,!0)},625:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"view-layout"},[t.spinShow?i("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),t.isNotPublish&&!t.isAdmin?i("div",{staticClass:"main"},[t._m(0),t._v(" "),t._m(1)]):t.isExpired&&!t.isAdmin?i("div",{staticClass:"main"},[i("div",{staticClass:"header"},[i("h1",[t._v("问卷已过期！")])]),t._v(" "),i("div",{staticClass:"content"},[i("p",[t._v("您所填写的问卷已到截止日期，暂不能填写。")])])]):t._e(),t._v(" "),!t.isExpired&&!t.isNotPublish||t.isAdmin?i("div",{staticClass:"main"},[i("div",{staticClass:"header"},[i("h1",[t._v(t._s(t.naire.title))])]),t._v(" "),i("div",{staticClass:"content"},[i("div",{staticClass:"intro"},[i("p",[t._v(t._s(t.naire.intro))]),t._v(" "),i("p",[t._v("截止日期："+t._s(t._f("timeFormat")(t.naire.deadline)))])]),t._v(" "),i("div",{staticClass:"user-info"},[i("Alert",{directives:[{name:"show",rawName:"v-show",value:!t.isLogin,expression:"!isLogin"}]},[t._v("在填写表单之前，请先填写用户信息。")]),t._v(" "),i("Form",{ref:"userInfo",attrs:{model:t.userInfo,rules:t.userInfoRule,inline:""}},[i("Form-item",{attrs:{prop:"name"}},[i("Input",{attrs:{placeholder:"请输入姓名"},model:{value:t.userInfo.name,callback:function(e){t.userInfo.name=e},expression:"userInfo.name"}})],1),t._v(" "),i("Form-item",{attrs:{prop:"identity"}},[i("Input",{attrs:{placeholder:"请输入身份证号"},model:{value:t.userInfo.identity,callback:function(e){t.userInfo.identity=e},expression:"userInfo.identity"}})],1),t._v(" "),i("Form-item",[i("Button",{attrs:{type:"primary"},on:{click:function(e){t.handleSubmit("userInfo")}}},[t._v("点击确认")])],1)],1)],1),t._v(" "),i("questionList",{attrs:{"question-list":this.naire.topic}},[i("Row",{staticClass:"code-row-bg",attrs:{type:"flex",justify:"center",align:"middle"}},[t.isAdmin?i("Button",{attrs:{type:"success"},on:{click:t.goBack}},[t._v("返回管理平台\n          ")]):t._e(),t._v(" "),i("Button",{attrs:{type:"primary",disabled:t.finished},on:{click:t.submitNaire}},[t._v("提交问卷\n          ")])],1)],1)],1),t._v(" "),t._m(2)]):t._e()],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"header"},[i("h1",[t._v("问卷未发布！")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("p",[t._v("您所填写的问卷未发布，暂不能填写。")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"footer"},[i("p",[t._v("Timu蜗壳工作室")])])}]}}});